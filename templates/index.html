<html>
<meta charset="utf-8" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
	<link rel="stylesheet" type="text/css" href="/normalize.css">
	<link rel="stylesheet" type="text/css" href="/foundation.min.css">
	<link rel="stylesheet" type="text/css" href="/foundation-icons.eot">
  	<link rel="stylesheet" type="text/css" href="/foundation-icons.css">
  	<link type="text/css" media="screen" rel="stylesheet" href="/responsive-tables.css" />
  	<link href='http://fonts.googleapis.com/css?family=Fredoka+One' rel='stylesheet' type='text/css'>
	<style type="text/css">
		.panel {
			margin-top: 30px;
		}
		body {
			background: #e8e8e8;
		}
		.name, .price, .number, .button, .total, label, select, th {
			font-family: 'Fredoka One', cursive;
		}

		.number {
			font-size: 300%;
		}

		.accordion .accordion-navigation>a, .accordion dd>a {
			font-family: 'Fredoka One', cursive;
		}

		.tabs dd.active a, .tabs .tab-title a {
			font-family: 'Fredoka One', cursive;
		}
	</style>
	<body>
		<nav class="top-bar" data-topbar role="navigation">
              <ul class="title-area">
                <li class="name">
                  <h1><a href="/"><i class="fi-home"></i> estore.com</a></h1>
                </li>
                 <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
                <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
              </ul>
            <section class="top-bar-section">
	            <!-- Right Nav Section -->
	            <ul class="right">
	              <li class="has-dropdown">
	                <a href=""><i class="fi-widget"></i> Menu </a>
	                <ul class="dropdown">
	                  <li><a href="/settings"><i class="fi-wrench"></i> Settings</a></li>
	                  <li><a href="/logout"><i class="fi-minus"></i> Logout</a></li>
	                </ul>
	              </li>
	            </ul>
	          </section>
        </nav>
		<div class="row">
			<div class="large-12 columns">
				<div class="panel">
					<ul class="tabs" data-tab>
					  <li class="tab-title active"><a href="#panel1"> <i class="fi-list"></i> List</a></li>
					  <li class="tab-title"><a href="#panel2"> <i class="fi-plus"></i> Store</a></li>
					  <li class="tab-title"><a href="#panel3"> <i class="fi-plus"></i> Product</a></li>
					</ul>
					<div class="tabs-content">
					  <div class="content active" id="panel1">
					    <ul id="store_list" class="accordion" data-accordion>
						  <hr>
						  <li class="accordion-navigation">
						    <a href="#panelsum">TOTAL SUM</a>
						    <div id="panelsum" class="content">
						      <table class="responsive">
								  <thead>
								    <tr>
								      <th width="150">Store Name</th>
								      <th width="150">Item Number</th>
								      <th width="150">Partial Item</th>
								      <th width="150">Total</th>
								      <th width="150">Partial Total</th>
								    </tr>
								  </thead>
								  <tbody id="total_sum">
								  	
								  </tbody>
							   </table>
						    </div>
						  </li>
						</ul>
					  </div>
					  <!-- Accordion List Products-->

					  <div class="content" id="panel2">
					    <form id="store_form" action="" method="post">
					    <div class="panel store">
					  
						  <div class="row">
						    <div class="large-12 columns">
						      <label>Store Name
						        <input id="store_name" type="text" name="name" placeholder="" required/>
						      </label>
						    </div>
						  </div>

						  <div class="row">
						    <div class="large-12 columns">
						      <label>Address
						        <input id="store_address" type="text" name="address" placeholder="" required/>
						      </label>
						    </div>
						  </div>

						  <div class="row">
						    <div class="large-12 columns">
						      <label>Phone
						        <input id="store_phone" type="text" name="phone" placeholder="" required/>
						      </label>
						    </div>
						  </div>

						   <div class="row">
						    <div class="large-12 columns">
						        <input type="submit" name="submit" value="Submit" class="button primary expand radius"/>
						    </div>
						  </div>
						</div>
						</form>
					  </div>
					  <!-- Add Store  -->
					  <div class="content" id="panel3">
					       <form id="product_form" action="/product" method="post" enctype="multipart/form-data">
						    <div class="panel product">
							  <div class="row">
							    <div class="large-12 columns">
							      <label>Product Name
							        <input id="product_name" type="text" name="name" placeholder="" required/>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							      <label>Product Price
							        <input id="product_name" type="text" name="price" placeholder="" required/>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							      <label>Product Number
							        <input id="product_number" type="number" name="number" placeholder="" required/>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							      <label>Currency
							      	<select name="currency">
							      	<option value="ADP">Andorran Peseta (ADP)</option><option value="AED">United Arab Emirates Dirham (AED)</option><option value="AFA">Afghanistan Afghani (AFA)</option><option value="ALL">Albanian Lek (ALL)</option><option value="ANG">Netherlands Antillian Guilder (ANG)</option><option value="AOK">Angolan Kwanza (AOK)</option><option value="ARS">Argentine Peso (ARS)</option><option value="AUD">Australian Dollar (AUD)</option><option value="AWG">Aruban Florin (AWG)</option><option value="BBD">Barbados Dollar (BBD)</option><option value="BDT">Bangladeshi Taka (BDT)</option><option value="BGN">Bulgarian Lev (BGN)</option><option value="BHD">Bahraini Dinar (BHD)</option><option value="BIF">Burundi Franc (BIF)</option><option value="BMD">Bermudian Dollar (BMD)</option><option value="BND">Brunei Dollar (BND)</option><option value="BOB">Bolivian Boliviano (BOB)</option><option value="BRL">Brazilian Real (BRL)</option><option value="BSD">Bahamian Dollar (BSD)</option><option value="BTN">Bhutan Ngultrum (BTN)</option><option value="BUK">Burma Kyat (BUK)</option><option value="BWP">Botswanian Pula (BWP)</option><option value="BZD">Belize Dollar (BZD)</option><option value="CAD">Canadian Dollar (CAD)</option><option value="CHF">Swiss Franc (CHF)</option><option value="CLF">Chilean Unidades de Fomento (CLF)</option><option value="CLP">Chilean Peso (CLP)</option><option value="CNY">Yuan (Chinese) Renminbi (CNY)</option><option value="COP">Colombian Peso (COP)</option><option value="CRC">Costa Rican Colon (CRC)</option><option value="CZK">Czech Republic Koruna (CZK)</option><option value="CUP">Cuban Peso (CUP)</option><option value="CVE">Cape Verde Escudo (CVE)</option><option value="CYP">Cyprus Pound (CYP)</option><option value="DKK">Danish Krone (DKK)</option><option value="DOP">Dominican Peso (DOP)</option><option value="DZD">Algerian Dinar (DZD)</option><option value="ECS">Ecuador Sucre (ECS)</option><option value="EGP">Egyptian Pound (EGP)</option><option value="EEK">Estonian Kroon (EEK) (EEK)</option><option value="ETB">Ethiopian Birr (ETB)</option><option value="EUR">Euro (EUR)</option><option value="FJD">Fiji Dollar (FJD)</option><option value="FKP">Falkland Islands Pound (FKP)</option><option value="GBP">British Pound (GBP)</option><option value="GHC">Ghanaian Cedi (GHC)</option><option value="GIP">Gibraltar Pound (GIP)</option><option value="GMD">Gambian Dalasi (GMD)</option><option value="GNF">Guinea Franc (GNF)</option><option value="GTQ">Guatemalan Quetzal (GTQ)</option><option value="GWP">Guinea-Bissau Peso (GWP)</option><option value="GYD">Guyanan Dollar (GYD)</option><option value="HKD">Hong Kong Dollar (HKD)</option><option value="HNL">Honduran Lempira (HNL)</option><option value="HTG">Haitian Gourde (HTG)</option><option value="HUF">Hungarian Forint (HUF)</option><option value="IDR">Indonesian Rupiah (IDR)</option><option value="IEP">Irish Punt (IEP)</option><option value="ILS">Israeli Shekel (ILS)</option><option value="INR">Indian Rupee (INR)</option><option value="IQD">Iraqi Dinar (IQD)</option><option value="IRR">Iranian Rial (IRR)</option><option value="JMD">Jamaican Dollar (JMD)</option><option value="JOD">Jordanian Dinar (JOD)</option><option value="JPY">Japanese Yen (JPY)</option><option value="KES">Kenyan Schilling (KES)</option><option value="KHR">Kampuchean (Cambodian) Riel (KHR)</option><option value="KMF">Comoros Franc (KMF)</option><option value="KPW">North Korean Won (KPW)</option><option value="KRW">(South) Korean Won (KRW)</option><option value="KWD">Kuwaiti Dinar (KWD)</option><option value="KYD">Cayman Islands Dollar (KYD)</option><option value="LAK">Lao Kip (LAK)</option><option value="LBP">Lebanese Pound (LBP)</option><option value="LKR">Sri Lanka Rupee (LKR)</option><option value="LRD">Liberian Dollar (LRD)</option><option value="LSL">Lesotho Loti (LSL)</option><option value="LYD">Libyan Dinar (LYD)</option><option value="MAD">Moroccan Dirham (MAD)</option><option value="MGF">Malagasy Franc (MGF)</option><option value="MNT">Mongolian Tugrik (MNT)</option><option value="MOP">Macau Pataca (MOP)</option><option value="MRO">Mauritanian Ouguiya (MRO)</option><option value="MTL">Maltese Lira (MTL)</option><option value="MUR">Mauritius Rupee (MUR)</option><option value="MVR">Maldive Rufiyaa (MVR)</option><option value="MWK">Malawi Kwacha (MWK)</option><option value="MXP">Mexican Peso (MXP)</option><option value="MYR">Malaysian Ringgit (MYR)</option><option value="MZM">Mozambique Metical (MZM)</option><option value="NAD">Namibian Dollar (NAD)</option><option value="NGN">Nigerian Naira (NGN)</option><option value="NIO">Nicaraguan Cordoba (NIO)</option><option value="NOK">Norwegian Kroner (NOK)</option><option value="NPR">Nepalese Rupee (NPR)</option><option value="NZD">New Zealand Dollar (NZD)</option><option value="OMR">Omani Rial (OMR)</option><option value="PAB">Panamanian Balboa (PAB)</option><option value="PEN">Peruvian Nuevo Sol (PEN)</option><option value="PGK">Papua New Guinea Kina (PGK)</option><option value="PHP">Philippine Peso (PHP)</option><option value="PKR">Pakistan Rupee (PKR)</option><option value="PLN">Polish Zloty (PLN)</option><option value="PYG">Paraguay Guarani (PYG)</option><option value="QAR">Qatari Rial (QAR)</option><option value="RON">Romanian Leu (RON)</option><option value="RWF">Rwanda Franc (RWF)</option><option value="SAR">Saudi Arabian Riyal (SAR)</option><option value="SBD">Solomon Islands Dollar (SBD)</option><option value="SCR">Seychelles Rupee (SCR)</option><option value="SDP">Sudanese Pound (SDP)</option><option value="SEK">Swedish Krona (SEK)</option><option value="SGD">Singapore Dollar (SGD)</option><option value="SHP">St. Helena Pound (SHP)</option><option value="SLL">Sierra Leone Leone (SLL)</option><option value="SOS">Somali Schilling (SOS)</option><option value="SRG">Suriname Guilder (SRG)</option><option value="STD">Sao Tome and Principe Dobra (STD)</option><option value="RUB">Russian Ruble (RUB)</option><option value="SVC">El Salvador Colon (SVC)</option><option value="SYP">Syrian Potmd (SYP)</option><option value="SZL">Swaziland Lilangeni (SZL)</option><option value="THB">Thai Baht (THB)</option><option value="TND">Tunisian Dinar (TND)</option><option value="TOP">Tongan Paanga (TOP)</option><option value="TPE">East Timor Escudo (TPE)</option><option value="TRY">Turkish Lira (TRY)</option><option value="TTD">Trinidad and Tobago Dollar (TTD)</option><option value="TWD">Taiwan Dollar (TWD)</option><option value="TZS">Tanzanian Schilling (TZS)</option><option value="UGX">Uganda Shilling (UGX)</option><option value="USD">US Dollar (USD)</option><option value="UYU">Uruguayan Peso (UYU)</option><option value="VEF">Venezualan Bolivar (VEF)</option><option value="VND">Vietnamese Dong (VND)</option><option value="VUV">Vanuatu Vatu (VUV)</option><option value="WST">Samoan Tala (WST)</option><option value="XAF">Communauté Financière Africaine BEAC, Francs (XAF)</option><option value="XAG">Silver, Ounces (XAG)</option><option value="XAU">Gold, Ounces (XAU)</option><option value="XCD">East Caribbean Dollar (XCD)</option><option value="XDR">International Monetary Fund (IMF) Special Drawing Rights (XDR)</option><option value="XOF">Communauté Financière Africaine BCEAO - Francs (XOF)</option><option value="XPD">Palladium Ounces (XPD)</option><option value="XPF">Comptoirs Français du Pacifique Francs (XPF)</option><option value="XPT">Platinum, Ounces (XPT)</option><option value="YDD">Democratic Yemeni Dinar (YDD)</option><option value="YER">Yemeni Rial (YER)</option><option value="YUD">New Yugoslavia Dinar (YUD)</option><option value="ZAR">South African Rand (ZAR)</option><option value="ZMK">Zambian Kwacha (ZMK)</option><option value="ZRZ">Zaire Zaire (ZRZ)</option><option value="ZWD">Zimbabwe Dollar (ZWD)</option><option value="SKK">Slovak Koruna (SKK)</option><option value="AMD">Armenian Dram (AMD)</option>
							      	</select>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							      <label>Product Store
							      	<select id="store_option" name="store">
							      		
							      	</select>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							      <label>Product Image
							        <input id="image_input" type="file" name="upload" placeholder="" class="button secondary expand" required/>
							      </label>
							    </div>
							  </div>

							  <div class="row">
							    <div class="large-12 columns">
							   		<label> Image Preview
							   			<div class="image" id="image">
							    	</label>
							      </div>
							    </div>
							  </div>
							  <br>
							   <div class="row">
							    <div class="large-12 columns">
							        <input type="submit" name="submit" value="Submit" class="button primary expand radius"/>
							    </div>
							  </div>
							</div>
						</form>
					  </div>
					  <!-- Add Products-->
					</div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="/jquery-1.11.2.min.js"></script>
	<script type="text/javascript" src="/foundation.min.js"></script>
	<script type="text/javascript" src="responsive-tables.js"></script>
	<script type="text/javascript">
		$(document).foundation();
		var sum_number = 0;
		var sum_price = 0;

		function del(obj){
			$.ajax({
	        	type:'GET',
	            url:'/delete/products/'+obj.id.split('_')[1],
	            success:function(Item, textStatus){
	            	var store = '';
					if(Item.status==="OK"){
						console.dir(Item);
						$('#tr_'+obj.id.split('_')[1]).remove();
						// show success msg
					}else {
						//error msg
						console.dir(Item);
						var div = '<div data-alert class="alert-box alert radius"> Error Deleting Store'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                        $('#panel3').prepend(div);
					}
				},
				error:function(res){
					console.dir(Item);
					var div = '<div data-alert class="alert-box alert radius"> Error'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                       $('#panel3').prepend(div);
				}
			});			
		}

		function readURL(input) {
		    if (input.files && input.files[0]) {
		        var reader = new FileReader();

		        reader.onload = function (e) {
		            $('#image').html('<img id="image" src="'+e.target.result+'" alt="Image Preview" />');
		        }
		        reader.readAsDataURL(input.files[0]);
		    }
		}

		$("#image_input").change(function(){
		    readURL(this);
		});

		function fill_store(store_uuid, store_name, id){
			$.ajax({
	        	type:'GET',
	            url:'/products/stores/'+store_uuid,
	            success:function(Item, textStatus){
					if(Item.status==="OK"){
						var number_count = 0;
						var price_count = 0;
						for(var i=0;i<Item.msg.length;i++){
							number_count+= Item.msg[i].number;
							price_count+=Item.msg[i].number*Item.msg[i].price
							var tr =
								    '<tr id="tr_'+Item.msg[i].uuid+'">'+
								      '<td>'+
								      	'<div class="image"><img src="/image/'+Item.msg[i].uuid+'"></div>'+
								      '</td>'+
								      '<td><p class="name">'+Item.msg[i].name+'</p></td>'+
								      '<td><p class="price">'+Item.msg[i].price+' '+Item.msg[i].currency+'</p></td>'+
								      '<td><p class="number">'+Item.msg[i].number+'</p></td>'+
								      '<td><p class="price">'+(Item.msg[i].number*Item.msg[i].price).toFixed(2)+' '+Item.msg[i].currency+'</p></td>'+

								      '<td>'+
								      	'<a class="button tiny alert radius expand" id="del_'+Item.msg[i].uuid+'" onclick="del(this);">Delete</a>'+
								     	'<a href="/update/products/'+Item.msg[i].uuid+'" class="button tiny secondary radius expand">Update</a>'+
								      '</td>'+
								    '</tr>';
								$("#tbody_"+store_uuid).prepend(tr);
						}
						sum_price+=price_count;
						sum_number+=number_count;

						console.log(sum_number+" "+sum_price)
						var tr =
								    '<tr>'+
								      '<td><p class="total">Total</p>'+
								      '</td>'+
								      '<td><p class="name">--</p></td>'+
								      '<td><p class="name">--</p></td>'+
								      '<td><p class="number">'+number_count+'</p></td>'+
								      '<td><p class="price">'+price_count.toFixed(2)+'</p></td>'+
								      '<td>--'+
								      '</td>'+
								    '</tr>'+
								    '<tr>';
								$("#tbody_"+store_uuid).append(tr);
						var tr_sum = '<tr>'+
								      '<td class="name"><p>'+store_name+
								      '</p></td>'+
								      '<td><p class="name">'+number_count+' Item</p></td>'+
								      '<td><p class="price">'+sum_number+'</p></td>'+
								      '<td><p class="text-right"><b>'+price_count.toFixed(2)+'</b></p></td>'+
								      '<td><p class="text-right"><b>'+sum_price.toFixed(2)+'</b></p></td>'+
								    '</tr>';
						$("#total_sum").append(tr_sum);

					}
				}
			});
		}

		$.ajax({
        	type:'GET',
            url:'/stores',
            success:function(Item, textStatus){
            	var store = '';
				if(Item.status==="OK"){
					for(var i=0;i<Item.msg.length;i++){
						store += '<option value="'+Item.msg[i].uuid+'">'+Item.msg[i].name+'</option>';
						var accordion='<li id="store_'+Item.msg[i].uuid+'" class="accordion-navigation">'+
							    '<a href="#panel_'+Item.msg[i].uuid+'">'+Item.msg[i].name+'</a>'+
							    '<div id="panel_'+Item.msg[i].uuid+'" class="content">'+
							      '<a href="/excel/'+Item.msg[i].uuid+'" class="button tiny success radius expand "> DOWDNLOAD EXCEL</a>'+
							      '<a href="/csv/'+Item.msg[i].uuid+'" class="button tiny info radius expand "> DOWDNLOAD CSV</a>'+
							      '<table class="responsive">'+
								  '<thead>'+
								    '<tr>'+
								      '<th width="70">Image</th>'+
								      '<th width="150">Name</th>'+
								      '<th width="150">Price</th>'+
								      '<th width="150">Number</th>'+
								      '<th width="150">SUM</th>'+
								      '<th width="150">Operation</th>'+
								    '</tr>'+
								  '</thead>'+
								  '<tbody id="tbody_'+Item.msg[i].uuid+'">'+
								  '</tbody>'+
								  '</table>'+
							    '</div>'+
							  '</li>';
						$("#store_list").prepend(accordion);
						fill_store(Item.msg[i].uuid, Item.msg[i].name);
					}
					console.log(sum_number+" "+sum_price) 
				}
				$('#store_option').prepend(store);
			},
			error:function(res){
			}
		});
	$('#store_form').on('submit', function(e) {
                        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                 
                        var $this = $(this); // L'objet jQuery du formulaire
                 
                        var store_name = $('#store_name').val();
                        var store_address = $('#store_address').val();
                        var store_phone = $("#store_phone").val();
                 
                        // Je vérifie une première fois pour ne pas lancer la requête HTTP
                        // si je sais que mon PHP renverra une erreur
                        if(store_name === '' || store_address === '' || store_phone === '') {
                            alert('Les champs doivent êtres remplis');
                        } else {
                            // Envoi de la requête HTTP en mode asynchrone
                            $.ajax({
                                url: '/store', // Le nom du fichier indiqué dans le formulaire
                                type: $this.attr('method'), // La méthode indiquée dans le formulaire (get ou post)
                                data: $this.serialize(), // Je sérialise les données (j'envoie toutes les valeurs présentes dans le formulaire)
                                success: function(res) { 
                                    if(res.status==="ERR"){
										var div = '<div data-alert class="alert-box alert radius"> Error Adding Store'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                                        $('.panel.store').prepend(div);
                                    }else {
                                        var div = '<div data-alert class="alert-box success radius"> Store Addeded'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                                        $('.panel.store').prepend(div);

                                        // clean store form
                                        $('#store_name').val('');
                        				$('#store_address').val('');
                        				$("#store_phone").val('');
                        				
                                    }
                                },
                                error:function(res, status){
                                        // dans le cas ou ajax fail
                                }
                            });
                        }
                    });

// add multipart attribute to this ajax

/*
$('#product_form').on('submit', function(e) {
                        e.preventDefault(); // J'empêche le comportement par défaut du navigateur, c-à-d de soumettre le formulaire
                 
                        var $this = $(this); // L'objet jQuery du formulaire
                 
                        var product_name = $('#product_name').val();
                        var product_price = $('#product_price').val();
                        var product_number = $("#product_number").val();
                 
                        // Je vérifie une première fois pour ne pas lancer la requête HTTP
                        // si je sais que mon PHP renverra une erreur
                        if(product_name === '' || product_price === '' || product_number === '') {
                            alert('Les champs doivent êtres remplis');
                        } else {
                            // Envoi de la requête HTTP en mode asynchrone
                            $.ajax({
                                url: '/product', // Le nom du fichier indiqué dans le formulaire
                                type: $this.attr('method'), // La méthode indiquée dans le formulaire (get ou post)
                                contentType: false,
                                data: $this.serialize(), // Je sérialise les données (j'envoie toutes les valeurs présentes dans le formulaire)
                                success: function(res) {
                                	console.dir(res); 
                                    if(res.status==="ERR"){
                                    	console.dir(res);
										var div = '<div data-alert class="alert-box alert radius"> Error Adding Product'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                                        $('.panel.product').prepend(div);
                                    }else {
                                        var div = '<div data-alert class="alert-box success radius"> Product Addeded'+
                          				'<a href="#" class="close">&times;</a>'+
                          				'</div>'                                        
                                        $('.panel.product').prepend(div);

                                        // clean store form
                                        $('#product_name').val('');
				                        $('#product_price').val('');
				                        $("#store_phone").val('');
				                        $("#image_input").val('');
                                    }
                                },
                                error:function(res, status){
                                        // dans le cas ou ajax fail
                                }
                            });
                        }
                    });
*/
	</script>
</html>